{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Parameters": {
    "KeyPair2DefaultKP": {
      "Default": "default",
      "Type": "String",
      "Description": ""
    },
    "LaunchAMI": {
      "Default": "ami-68d8e93a",
      "Type": "String",
      "Description": "AMI Of initial Servers"
    },
    "project": {
      "Default": "cloudready",
      "Type": "String",
      "Description": "Base Project Name "
    },
    "RDSSize": {
      "Default": "db.t2.micro",
      "Type": "String",
      "Description": ""
    },
    "EC2Size": {
      "Default": "t2.micro",
      "Type": "String",
      "Description": ""
    },
    "IAMProfile": {
      "Default": "iam",
      "Type": "String",
      "Description": ""
    },

    "DBPassword": {
      "Default": "wrig7pIj4Es3",
      "Type": "String",
      "Description": ""
    },
    "DBMaster": {
      "Default": "cloudready",
      "Type": "String",
      "Description": ""
    }
  },
  "Description": "Cloudformation generated by Paul",
  "Resources": {
    "SecurityGroup2office2Egress20": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "ToPort": "65535",
        "FromPort": "0",
        "GroupId": {
          "Ref": "SecurityGroup2office"
        },
        "IpProtocol": "-1",
        "CidrIp": "0.0.0.0/0"
      }
    },
    "SecurityGroup2lb2Ingress21": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "ToPort": "11211",
        "FromPort": "11211",
        "CidrIp": "10.1.0.0/16",
        "GroupId": {
          "Ref": "SecurityGroup2Cache"
        },
        "IpProtocol": "tcp"
      }
    },
   
    "SecurityGroup2DefaultSG2Ingress20": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "ToPort": "22",
        "FromPort": "22",
        "CidrIp": "0.0.0.0/0",
        "GroupId": {
          "Ref": "SecurityGroup2DefaultSG"
        },
        "IpProtocol": "tcp"
      }
    },
    "Subnet2Weba": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "Tags": [],
        "VpcId": {
          "Ref": "VPCMain"
        },
        "CidrBlock": "10.1.0.0/24",
        "AvailabilityZone": "ap-southeast-1a"
      }
    },
    "NetworkAcl2DefaultACL2AssociationSet20": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "Subnet2Weba"
        },
        "NetworkAclId": {
          "Ref": "NetworkAcl2DefaultACL"
        }
      }
    },
    "RouteTable2RT02AssociationSet22": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "Subnet2Weba"
        },
        "RouteTableId": {
          "Ref": "RouteTable2RT0"
        }
      }
    },
    "Subnet2lba": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "Tags": [],
        "VpcId": {
          "Ref": "VPCMain"
        },
        "CidrBlock": "10.1.2.0/24",
        "AvailabilityZone": "ap-southeast-1a"
      }
    },
    "SecurityGroup2DefaultSG2IpPermissionsEgress20": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "ToPort": "65535",
        "FromPort": "0",
        "GroupId": {
          "Ref": "SecurityGroup2DefaultSG"
        },
        "IpProtocol": "-1",
        "CidrIp": "0.0.0.0/0"
      }
    },
    "Subnet2lbb": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "Tags": [],
        "VpcId": {
          "Ref": "VPCMain"
        },
        "CidrBlock": "10.1.3.0/24",
        "AvailabilityZone": "ap-southeast-1b"
      }
    },
    "SecurityGroup2web": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "VpcId": {
          "Ref": "VPCMain"
        },
        "GroupDescription": "Custom Security Group",
        "Tags": [
          {
            "Value": "false",
            "Key": "visops_default"
          }
        ]
      }
    },
    "Subnet2dba": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "Tags": [],
        "VpcId": {
          "Ref": "VPCMain"
        },
        "CidrBlock": "10.1.4.0/24",
        "AvailabilityZone": "ap-southeast-1a"
      }
    },
    "Subnet2dbb": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "Tags": [],
        "VpcId": {
          "Ref": "VPCMain"
        },
        "CidrBlock": "10.1.5.0/24",
        "AvailabilityZone": "ap-southeast-1b"
      }
    },
    "VPCMain": {
      "Type": "AWS::EC2::VPC",
      "Properties": {
        "CidrBlock": "10.1.0.0/16",
        "EnableDnsSupport": true,
        "InstanceTenancy": "default",
        "EnableDnsHostnames": true
      }
    },
    "SecurityGroup2DefaultSG": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "VpcId": {
          "Ref": "VPCMain"
        },
        "GroupDescription": "default VPC security group",
        "Tags": [
          {
            "Value": "true",
            "Key": "visops_default"
          }
        ]
      }
    },
    "SecurityGroup2lb": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "VpcId": {
          "Ref": "VPCMain"
        },
        "GroupDescription": "Custom Security Group",
        "Tags": [
          {
            "Value": "false",
            "Key": "visops_default"
          }
        ]
      }
    },
    "RouteTable2RT02RouteSet21": {
      "Type": "AWS::EC2::Route",
      "Properties": {
        "GatewayId": {
          "Ref": "InternetGateway2Internetgateway"
        },
        "DestinationCidrBlock": "0.0.0.0/0",
        "RouteTableId": {
          "Ref": "RouteTable2RT0"
        }
      }
    },
    "Subnet2Webb": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "Tags": [],
        "VpcId": {
          "Ref": "VPCMain"
        },
        "CidrBlock": "10.1.1.0/24",
        "AvailabilityZone": "ap-southeast-1b"
      }
    },
    "DBInstance2main": {
      "Type": "AWS::RDS::DBInstance",
      "Properties": {
        "Engine": "mysql",
        "DBParameterGroupName": "default.mysql5.6",
        "AllowMajorVersionUpgrade": "false",
        "MultiAZ": "false",
        "MasterUsername": {
          "Ref": "DBMaster"
        },
        "LicenseModel": "general-public-license",
        "MasterUserPassword": {
          "Ref": "DBPassword"
        },
        "AutoMinorVersionUpgrade": "true",
        "VPCSecurityGroups": [
          {
            "Ref": "SecurityGroup2db"
          }
        ],
        "AllocatedStorage": 5,
        "EngineVersion": "5.6.22",
        "DBInstanceClass": {
          "Ref": "RDSSize"
        },
        "BackupRetentionPeriod": 1,
        "Port": 3306,
        "DBSubnetGroupName": {
          "Ref": "DBSubnetGroup2subnetgroup0"
        },
        "DBInstanceIdentifier": {
          "Fn::Join": [
            "",
            [
              "",
              {
                "Ref": "project"
              },
              "-database"
            ]
          ]
        }
      }
    },
    "SecurityGroup2web2Egress20": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "ToPort": "65535",
        "FromPort": "0",
        "GroupId": {
          "Ref": "SecurityGroup2web"
        },
        "IpProtocol": "-1",
        "CidrIp": "0.0.0.0/0"
      }
    },
    "SecurityGroup2DefaultSG2IpPermissions22": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "ToPort": "22",
        "FromPort": "22",
        "CidrIp": "0.0.0.0/0",
        "GroupId": {
          "Ref": "SecurityGroup2DefaultSG"
        },
        "IpProtocol": "tcp"
      }
    },
    "RouteTable2RT0": {
      "Type": "AWS::EC2::RouteTable",
      "Properties": {
        "VpcId": {
          "Ref": "VPCMain"
        },
        "Tags": [
          {
            "Value": "true",
            "Key": "visops_default"
          }
        ]
      }
    },
    "SecurityGroup2web2Ingress20": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "ToPort": "80",
        "FromPort": "80",
        "CidrIp": "10.1.0.0/16",
        "GroupId": {
          "Ref": "SecurityGroup2web"
        },
        "IpProtocol": "tcp"
      }
    },
    "DBSubnetGroup2subnetgroup0": {
      "Type": "AWS::RDS::DBSubnetGroup",
      "Properties": {
        "SubnetIds": [
          {
            "Ref": "Subnet2dba"
          },
          {
            "Ref": "Subnet2dbb"
          }
        ],
        "DBSubnetGroupDescription": "subnetgroup0 default description"
      }
    },
    "NetworkAcl2DefaultACL2AssociationSet22": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "Subnet2lba"
        },
        "NetworkAclId": {
          "Ref": "NetworkAcl2DefaultACL"
        }
      }
    },
    "NetworkAcl2DefaultACL2AssociationSet23": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "Subnet2lbb"
        },
        "NetworkAclId": {
          "Ref": "NetworkAcl2DefaultACL"
        }
      }
    },
    "SecurityGroup2db2Ingress20": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "ToPort": "3306",
        "FromPort": "3306",
        "CidrIp": "10.1.0.0/16",
        "GroupId": {
          "Ref": "SecurityGroup2db"
        },
        "IpProtocol": "tcp"
      }
    },
    "SecurityGroup2DefaultSG2Egress20": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "ToPort": "65535",
        "FromPort": "0",
        "GroupId": {
          "Ref": "SecurityGroup2DefaultSG"
        },
        "IpProtocol": "-1",
        "CidrIp": "0.0.0.0/0"
      }
    },
    "NetworkAcl2DefaultACL": {
      "Type": "AWS::EC2::NetworkAcl",
      "Properties": {
        "VpcId": {
          "Ref": "VPCMain"
        },
        "Tags": [
          {
            "Value": "true",
            "Key": "visops_default"
          }
        ]
      }
    },
    "SecurityGroup2office2IpPermissionsEgress20": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "ToPort": "65535",
        "FromPort": "0",
        "GroupId": {
          "Ref": "SecurityGroup2office"
        },
        "IpProtocol": "-1",
        "CidrIp": "0.0.0.0/0"
      }
    },
    "NetworkAcl2DefaultACL2AssociationSet24": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "Subnet2dba"
        },
        "NetworkAclId": {
          "Ref": "NetworkAcl2DefaultACL"
        }
      }
    },
    "NetworkAcl2DefaultACL2AssociationSet25": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "Subnet2dbb"
        },
        "NetworkAclId": {
          "Ref": "NetworkAcl2DefaultACL"
        }
      }
    },
    "SecurityGroup2office": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "VpcId": {
          "Ref": "VPCMain"
        },
        "GroupDescription": "Custom Security Group",
        "Tags": [
          {
            "Value": "false",
            "Key": "visops_default"
          }
        ]
      }
    },
    "SecurityGroup2db": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "VpcId": {
          "Ref": "VPCMain"
        },
        "GroupDescription": "Custom Security Group",
        "Tags": [
          {
            "Value": "false",
            "Key": "visops_default"
          }
        ]
      }
    },
    "AttachInternetGateway": {
      "Type": "AWS::EC2::VPCGatewayAttachment",
      "Properties": {
        "VpcId": {
          "Ref": "VPCMain"
        },
        "InternetGatewayId": {
          "Ref": "InternetGateway2Internetgateway"
        }
      }
    },
    "InternetGateway2Internetgateway": {
      "Type": "AWS::EC2::InternetGateway",
      "Properties": {}
    },
    "SecurityGroup2web2IpPermissions22": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "ToPort": "80",
        "FromPort": "80",
        "CidrIp": "10.1.0.0/16",
        "GroupId": {
          "Ref": "SecurityGroup2web"
        },
        "IpProtocol": "tcp"
      }
    },
    "RouteTable2RT02AssociationSet26": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "Subnet2dba"
        },
        "RouteTableId": {
          "Ref": "RouteTable2RT0"
        }
      }
    },
    "RouteTable2RT02AssociationSet23": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "Subnet2dbb"
        },
        "RouteTableId": {
          "Ref": "RouteTable2RT0"
        }
      }
    },
    "SecurityGroup2web2IpPermissionsEgress20": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "ToPort": "65535",
        "FromPort": "0",
        "GroupId": {
          "Ref": "SecurityGroup2web"
        },
        "IpProtocol": "-1",
        "CidrIp": "0.0.0.0/0"
      }
    },
    "RouteTable2RT02AssociationSet27": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "Subnet2Webb"
        },
        "RouteTableId": {
          "Ref": "RouteTable2RT0"
        }
      }
    },
    "SecurityGroup2db2IpPermissions22": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "ToPort": "3306",
        "FromPort": "3306",
        "CidrIp": "10.1.0.0/16",
        "GroupId": {
          "Ref": "SecurityGroup2db"
        },
        "IpProtocol": "tcp"
      }
    },
    "RouteTable2RT02AssociationSet25": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "Subnet2lba"
        },
        "RouteTableId": {
          "Ref": "RouteTable2RT0"
        }
      }
    },
    "RouteTable2RT02AssociationSet24": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "Subnet2lbb"
        },
        "RouteTableId": {
          "Ref": "RouteTable2RT0"
        }
      }
    },
    "NetworkAcl2DefaultACL2EntrySet21": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "NetworkAcl2DefaultACL"
        },
        "RuleNumber": 100,
        "Protocol": -1,
        "PortRange": {
          "To": "",
          "From": ""
        },
        "Egress": false,
        "RuleAction": "allow",
        "Icmp": {
          "Code": "",
          "Type": ""
        },
        "CidrBlock": "0.0.0.0/0"
      }
    },
    "NetworkAcl2DefaultACL2EntrySet20": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "NetworkAcl2DefaultACL"
        },
        "RuleNumber": 100,
        "Protocol": -1,
        "PortRange": {
          "To": "",
          "From": ""
        },
        "Egress": true,
        "RuleAction": "allow",
        "Icmp": {
          "Code": "",
          "Type": ""
        },
        "CidrBlock": "0.0.0.0/0"
      }
    },
    "NetworkAcl2DefaultACL2AssociationSet21": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "Subnet2Webb"
        },
        "NetworkAclId": {
          "Ref": "NetworkAcl2DefaultACL"
        }
      }
    },
    "SecurityGroup2lb2Ingress20": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "ToPort": "80",
        "FromPort": "80",
        "CidrIp": "0.0.0.0/0",
        "GroupId": {
          "Ref": "SecurityGroup2lb"
        },
        "IpProtocol": "tcp"
      }
    },
    "SecurityGroup2lb2IpPermissions22": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "ToPort": "80",
        "FromPort": "80",
        "CidrIp": "10.1.0.0/16",
        "GroupId": {
          "Ref": "SecurityGroup2lb"
        },
        "IpProtocol": "tcp"
      }
    },
   
  
    "IgniteJenkins": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "ToPort": "22",
        "FromPort": "22",
        "CidrIp": "54.164.203.159/32",
        "GroupId": {
          "Ref": "SecurityGroup2office"
        },
        "IpProtocol": "tcp"
      }
    },
      
 
    "SettingsBucket": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketName": {
          "Fn::Join": [
            "",
            [
              "",
              {
                "Ref": "VPCMain"
              }
            ]
          ]
        }
      }
    },
  
    "SecurityGroup2Cache": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "VpcId": {
          "Ref": "VPCMain"
        },
        "GroupDescription": "Cache Security Group"
      }
    }
   
    
  }
}